SubGram API

Введение
Publisher API
Advertiser API
Общее
Webhooks
Publisher API
Получение спонсоров
Управление ботами
Проверка подписок
Publisher API
Методы для владельцев ботов для монетизации трафика.

Получение спонсоров
POST
/get-sponsors
Основной метод для запроса блока обязательной подписки. Сервис анализирует пользователя и подбирает для него наиболее релевантный список спонсоров. Аутентификация происходит по API-ключу бота в заголовке Auth.

Параметры запроса (Body, JSON)
Параметр	Тип	Обязательный	Описание
chat_id	Integer	Да	ID чата, откуда идет запрос.
user_id	Integer	Да	ID пользователя Telegram.
first_name	String	Условно*	Имя пользователя в Telegram.
username	String	Условно*	Юзернейм пользователя (без @).
language_code	String	Условно*	Язык интерфейса Telegram у пользователя (например, "ru", "en").
is_premium	Boolean	Условно*	Наличие у пользователя Telegram Premium: true или false.
action	String	Нет	Тип действия:
subscribe (по умолчанию): Список спонсоров закрепляется за пользователем.
newtask: Список не закрепляется.
gender	String	Нет	Пол пользователя:
male (мужской)
female (женский)
age	Integer/String	Нет	Возраст пользователя. Можно передать число (25) или категорию:
c1: Младше 10
c2: 11-13
c3: 14-15
c4: 16-17
c5: 18-24
c6: 25 и старше
max_sponsors	Integer	Нет	Макс. кол-во спонсоров (ссылок на каналы/чаты) в ответе (1-10).
exclude_resource_ids	Array[String]	Нет	Массив ID каналов/ботов для исключения. Пример: ["-100123...", "54321..."].
exclude_ads_ids	Array[Integer]	Нет	Массив ID заказов для исключения.
* — эти поля становятся обязательными, если ваш бот был добавлен в систему без токена.

Важно: Параметры gender и age следует передавать, только если пользователь явно предоставил эти данные (например, через опрос в боте или форму регистрации). Запрещено угадывать или передавать предполагаемые значения.
Примеры запросов
# Пример тела запроса в формате JSON (cURL)
curl -X POST https://api.subgram.org/get-sponsors \
-H "Auth: ВАШ_API_КЛЮЧ_БОТА" \
-H "Content-Type: application/json" \
-d '{
      "user_id": 123456789,
      "chat_id": 123456789,
      #Параметры ниже если не передавали токен от бота
      #"first_name": "Иван",
      #"username": "ivanov",
      #"language_code": "ru",
      #"is_premium": false,
    }'
Копировать
Вариант 1: «Под ключ» (поделились токеном от бота и «Получать ссылки по API» выключено)

Копировать
Вариант 2: «Получение ссылок» (не поделились токеном или «Получать ссылки по API» включено)

Копировать
Описание ответа
Сервер обрабатывает ваш запрос и возвращает JSON, на основе которого вы должны строить логику в боте. Возможны следующие варианты:

Статус ответа	HTTP Код	Что делать
ok	200	Можно пропускать пользователя. Это означает, что он либо уже подписан на все ресурсы, либо для него не нашлось подходящих спонсоров (HTTP код ответа при этом будет 404).
warning	200	Не пропускать. Пользователю нужно выполнить действие (например, подписаться на канал).
register	200	Не пропускать. Требуется показать анкету. В поле additional.registration_url будет ссылка для кнопки WebApp.
gender / age	200	Не пропускать. Сервис не смог определить пол/возраст. Требуется отправить пользователю кнопки с вариантами и при повторном запросе передать его выбор.
error	4xx/5xx	Произошла ошибка (неверный API-ключ, ошибка сервера и т.д.). Сообщение будет в поле message.
Ответ со статусом register (Анкета Web App)
Если для пользователя требуется сбор дополнительной информации (пол/возраст) и в настройках бота включена опция "Показывать анкету", вы получите следующий ответ. Ваша задача — создать inline-кнопку, которая откроет эту ссылку как Web App.

Подробнее о том, как выглядит и работает анкета, можно прочитать в нашей статье: Что такое анкета?
Пример ответа
{
    "status": "register",
    "code": 200,
    "message": "Требуется дополнительная информация о пользователе.",
    "additional": {
        "registration_url": "https://api.subgram.org/user-form?token=gYRNST3HF1"
    }
}
Копировать
Пример создания WebApp кнопки на Aiogram (если не добавляли токен от бота или "Получать ссылки в API" вкл.)
Примечание: Если Вы предоставляли токен от бота и "Получать ссылки в API" - Выкл, то НИЧЕГО ИЗМЕНЯТЬ/ДОПОЛНЯТЬ НЕ НУЖНО, все работает как на старой версии API, так и на новой (иными словами - "под ключ")
from aiogram.types import InlineKeyboardMarkup, InlineKeyboardButton, WebAppInfo
from aiogram.utils.keyboard import InlineKeyboardBuilder

# response - это ваш JSON-ответ от API со статусом "register"
reg_url = response['additional']['registration_url']

builder = InlineKeyboardBuilder()

# Кнопка для открытия WebApp
builder.button(
    text="✅ Пройти быструю регистрацию",
    web_app=WebAppInfo(url=reg_url)
)
# Кнопка для повторной проверки ПОСЛЕ заполнения анкеты
builder.button(
    text="Продолжить",
    callback_data="subgram-op" # тот же колбэк, что и у "Я выполнил"
)
builder.adjust(1)

await message.answer(
    "Для продолжения, пожалуйста, укажите ваш пол и возраст.", 
    reply_markup=builder.as_markup()
)
Копировать
Структура объекта в массиве sponsors
Поле	Тип	Описание
ads_id	String	Уникальный ID рекламной кампании.
link	String	Готовая ссылка для подписки/перехода.
resource_id	String	Уникальный ID ресурса (канала или бота) в Telegram.
type	String	Тип ресурса:
channel: Канал или чат.
bot: Telegram бот.
resource: Внешний ресурс (miniapp, сайт) или канал/бот, для которого не требуется проверка подписки.
status	String	Текущий статус подписки:
subscribed: Подписан.
unsubscribed: Не подписан.
notgetted: Пользователь подписан на канал, ему можно дать доступ к контенту, однако он уже был в канале ранее и отписался. Telegram не засчитал его как уникального подписчика и не учел вступление по пригласительной ссылке (не отображается в статистике по ней). В данных ситуациях мы не берем деньги с рекламодателя и, соответственно, не выплачиваем владельцу бота
available_now	Boolean	Флаг, активен ли спонсор в данный момент. Если false, его не следует показывать.
button_text	String	Рекомендуемый текст для кнопки (например "Подписаться").
resource_logo	String	URL на логотип ресурса. Может быть пустой строкой.
resource_name	String	Название ресурса (канала, бота).
Управление ботами
POST
/bots
Единый эндпоинт для добавления, обновления и получения информации о ваших ботах. Аутентификация происходит по вашему ключу-доступа (Secret Key), переданному в заголовке Auth.
В теле запроса обязательно должно быть поле action, которое определяет действие.

Action: add — Добавление нового бота
Регистрирует нового бота в системе и возвращает его API-ключ.

Параметр	Тип	Обязательный	Описание
action	String	Да	Всегда "add".
bot_token	String	Условно*	Токен бота от @BotFather.
bot_id	Integer	Условно*	ID бота. Обязателен, если нет bot_token.
bot_name	String	Условно*	Имя бота. Обязателен, если нет bot_token.
bot_nickname	String	Условно*	Юзернейм бота (без @). Обязателен, если нет bot_token.
*Необходимо указать либо bot_token, либо набор bot_id, bot_name, bot_nickname.
time_purge	Integer	Нет	Время (в минутах), на которое будет закеширован список спонсоров, подобранный для пользователя. По умолч.: 180. (5-4320).
max_sponsors	Integer	Нет	Кол-во спонсоров, которое сервис будет выдавать при запросе пользователю. По умолч.: 4. (1-10).
get_links	Integer	Нет	Получать только ссылки (1) или позволить SubGram отправлять блок ОП самостоятельно (0). По умолч.: 0.
show_quiz	Integer	Нет	Показывать Web App анкету для сбора пола/возраста (1) или нет (0). По умолч.: 1.
gender_question	Integer	Нет	Задавать ли вопрос о поле, если он не определен (1 - да, 0 - нет). По умолч.: 1.
age_question	Integer	Нет	Задавать ли вопрос о возрасте, если он не определен (1 - да, 0 - нет). По умолч.: 0.
text_op	String	Нет	Кастомный текст для блока ОП. Укажите null для сброса на стандартный текст.
image_op	String	Нет	URL изображения для блока ОП. null для удаления картинки.
forbidden_themes	Array[String]	Нет	Массив кодов категорий рекламы для исключения.
Актуальный список кодов можно получить из эндпоинта /filters (в объекте filters.bots.forbidden_themes).
Пример запроса (add)
{
                      "action": "add",
                      "bot_token": "123456:ABC-DEF1234ghIkl-zyx57W2v1u123ew11",
                      "max_sponsors": 3,
                      "text_op": "Для доступа к эксклюзиву, подпишись:",
                      "forbidden_themes": ["crypto", "games"]
                    }
Копировать
Пример ответа (add)
{
                      "status": "ok",
                      "message": "Бот успешно добавлен.",
                      "result": { "api_key": "a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4" }
                    }
Копировать
Action: update — Обновление бота
Изменяет настройки существующего бота.

Параметр	Тип	Обязательный	Описание
action	String	Да	Всегда "update".
bot_id	Integer	Да	ID бота, настройки которого нужно изменить.
is_on	Integer	Нет	Включить (1) или выключить (0) бота в системе SubGram.
Все остальные параметры из действия add не обязательны. Передавайте только те, которые хотите изменить.
Пример запроса (update)
{
                      "action": "update",
                      "bot_id": 123456789,
                      "is_on": 0,
                      "time_purge": 60
                    }
Копировать
Action: info — Получение информации
Возвращает полную информацию и настройки по указанному боту.

Параметр	Тип	Обязательный	Описание
action	String	Да	Всегда "info".
bot_id	Integer	Да	ID бота, информацию о котором нужно получить.
Пример ответа (info)
{
                        "status": "ok",
                        "message": "Информация о боте получена.",
                        "result": {
                            "bot_id": 123456789,
                            "bot_name": "Мой Супер Бот",
                            "bot_nickname": "MySuperBot",
                            "status": "active",
                            "note": null,
                            "is_on": 1,
                            "profit": 12345.67,
                            "profit_own_orders": 123.45,
                            "api_key": "a1b2c3d4e5f6a1b2c3d4e5f6a1b2c3d4",
                            "time_purge": 180,
                            "max_sponsors": 4,
                            "get_links": 0,
                            "gender_question": 1,
                            "age_question": 0,
                            "show_quiz": 1,
                            "text_op": "Для доступа к эксклюзиву, подпишись:",
                            "image_op": "https://api.subgram.org/image-op/some-image.jpg",
                            "forbidden_themes": ["crypto", "games"]
                        }
                    }
Копировать
Проверка подписок
POST
/get-user-subscriptions
Позволяет проверить статус подписки конкретного пользователя на один или несколько ресурсов. Аутентификация по API-ключу бота.

Параметры запроса (Body, JSON)
Параметр	Тип	Обязательный	Описание
user_id	Integer	Да	ID пользователя Telegram, чьи подписки нужно проверить.
links	Array[String]	Нет	Массив ссылок, статус подписки на которые нужно проверить.
start_date	String	Нет	Начальная дата для выборки в формате YYYY-MM-DD.
end_date	String	Нет	Конечная дата для выборки в формате YYYY-MM-DD.
Примечание: Если не передать ни links, ни даты, метод вернет все подписки пользователя за последние 30 дней.
Пример запроса
{
                      "user_id": 123456789,
                      "links": [
                        "https://t.me/+AbCdEfGhIjKlMnOp",
                        "https://t.me/some_bot"
                      ]
                    }
Копировать
Пример успешного ответа (HTTP 200)
{
                      "status": "ok",
                      "code": 200,
                      "message": "Информация о подписках получена",
                      "additional": {
                        "sponsors": [
                          {
                            "ads_id": "123",
                            "link": "https://t.me/+AbCdEfGhIjKlMnOp",
                            "resource_id": "-100123456789",
                            "type": "channel",
                            "status": "subscribed",
                            "available_now": true,
                            "button_text": "Подписаться",
                            "resource_logo": "https://img.subgram.ru/...",
                            "resource_name": "Название Канала"
                          },
                          {
                            "ads_id": "124",
                            "link": "https://t.me/some_bot?start=ref",
                            "resource_id": "987654321",
                            "type": "bot",
                            "status": "unsubscribed",
                            "available_now": true,
                            "button_text": "Запустить бота",
                            "resource_logo": "",
                            "resource_name": "Какой-то бот"
                          }
                        ]
                      }
                    }
Копировать